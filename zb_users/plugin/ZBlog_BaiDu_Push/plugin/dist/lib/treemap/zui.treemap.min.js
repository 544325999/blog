/*!
 * ZUI: 树形图 - v1.7.0 - 2017-06-17
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2017 cnezsoft.com; Licensed MIT
 */
!function(aJf,EcJ,aAd,SfL,chg){"use strict";var HdE="zui.treemap",fKf={data:[],cableWidth:1,cableColor:"#808080",cableStyle:"solid",rowSpace:30,nodeSpace:20,listenNodeResize:!0,nodeTemplate:'<div class="treemap-node"><a class="treemap-node-wrapper"></a></div>',foldable:!0,clickNodeToFold:!0},VfI=function(EcJ){return EcJ.children("li,.treemap-data-item").map(function(){var EcJ=aJf(this),aAd=EcJ.data(),SfL=EcJ.children(".text"),chg=EcJ.children(".content"),HdE=EcJ.children("ul,.treemap-data-list");if(SfL.length&&(aAd.text=SfL.text()),chg.length&&(aAd.html=chg.html()),HdE.length&&(aAd.children=VfI(HdE)),!aAd.text&&!aAd.html){var fKf=EcJ.children(":not(ul,.treemap-data-list)"),aQd=EcJ.clone();aQd.find("ul,.treemap-data-list").remove(),fKf.length?aAd.html=aQd.html():aAd.text=aQd.text()}return aAd}).get()},aQd=function(EcJ,aAd){var SfL=aJf(EcJ);aJf.isArray(aAd)&&(aAd={data:aAd}),aAd=aJf.extend({},fKf,SfL.data(),aAd);var chg=aAd.data||[];if(!chg.length){var HdE=SfL.children(".treemap-data");HdE.length&&(chg=VfI(HdE.hide()))}var aQd=SfL.children(".treemap-nodes");aQd.length||(aQd=aJf('<div class="treemap-nodes" unselectable="on"/>').appendTo(SfL));var Red=this;Red.$=SfL,Red.$nodes=aQd,Red.data=aJf.isArray(chg)?chg:[chg],Red.options=aAd,Red.offsetX=0,Red.offsetY=0,Red.scale=aAd.scale||1,Red.render(),aQd.on("resize",".treemap-node-wrapper",function(){Red.delayDrawLines()}),aAd.foldable&&aQd.on("click",aAd.clickNodeToFold?".treemap-node-wrapper":".treemap-node-fold-icon",function(){Red.toggle(aJf(this).closest(".treemap-node"))}),aQd.on("click",".treemap-node-wrapper",function(){var EcJ=aJf(this).closest(".treemap-node");Red.callEvent("onNodeClick",EcJ.data("node"))})};aQd.prototype.toggle=function(aJf,EcJ){var aAd=this;"boolean"==typeof aJf&&(EcJ=aJf,aJf=null),aJf||(aJf=aAd.$nodes.children(".treemap-node").first()),EcJ===chg&&(EcJ=!aJf.hasClass("collapsed")),aJf.addClass("tree-node-collapsing").toggleClass("collapsed",EcJ).find('[data-toggle="tooltip"]').tooltip("hide"),aAd.$nodes.find(".tooltip").remove(),aAd.drawLines(),clearTimeout(aAd.toggleTimeTask),aAd.toggleTimeTask=setTimeout(function(){aJf.removeClass("tree-node-collapsing")},200)},aQd.prototype.render=function(aJf){var EcJ=this;EcJ.data=aJf||EcJ.data,EcJ.data&&(EcJ.createNodes(),EcJ.drawLines()),EcJ.callEvent("afterRender")},aQd.prototype.createNodes=function(EcJ,aAd,SfL){var chg=this,fKf=chg.options,VfI=fKf.rowSpace,aQd=chg.$nodes;aAd||(aQd.find(".treemap-node-wrapper").off("resize."+HdE),aQd.empty()),fKf.sort&&EcJ.sort(aJf.isFunction(fKf.sort)?fKf.sort:function(aJf,EcJ){return(aJf.order||0)-EcJ.order});var Red=null;EcJ=EcJ||chg.data,aJf.each(EcJ||chg.data,function(gPe,SeZ){"string"==typeof SeZ&&(SeZ={html:SeZ},EcJ[gPe]=SeZ),SeZ.id||(SeZ.id=aJf.zui.uuid());var bXg=aJf.isFunction(fKf.nodeTemplate),JeG=bXg?fKf.nodeTemplate(SeZ,chg):aJf(fKf.nodeTemplate),ddf=JeG.find(".treemap-node-wrapper");ddf.length||(ddf=aJf('<div class="treemap-node-wrapper"/>').appendTo(JeG));var McQ=SeZ.children,bhf=McQ&&McQ.length;SeZ.isOnlyOneChild=1===bhf,SeZ.idx=gPe;var AaC=aAd?aAd.row+1:0;JeG.toggleClass("treemap-node-has-child",!!bhf).toggleClass("treemap-node-has-parent",!!aAd).toggleClass("treemap-node-one-child",1===bhf).toggleClass("collapsed",!!SeZ.collapsed&&"false"!==SeZ.collapsed).toggleClass("treemap-node-root",!AaC).attr("data-id",SeZ.id).data("node",SeZ),SeZ.className&&JeG.addClass(SeZ.className),SeZ.row=AaC;var dJf=aJf.extend({},fKf.nodeStyle,SeZ.style);SeZ.textColor&&(dJf.color=SeZ.textColor),SeZ.color&&(dJf.backgroundColor=SeZ.color),SeZ.border&&(dJf.border=SeZ.border);var Q=aJf.extend({},SeZ.attrs,{title:SeZ.caption});if(SeZ.tooltip&&(Q["data-toggle"]="tooltip",Q.title=SeZ.tooltip),ddf.attr(Q).css(dJf),Red&&JeG.css("padding-left",fKf.nodeSpace),bXg||(SeZ.html?ddf.append(SeZ.html):SeZ.text&&ddf.text(SeZ.text)),JeG.appendTo(aAd?aAd.$children:aQd),SeZ.bounds={width:ddf.outerWidth(),height:ddf.outerHeight()},Red&&(Red.next=SeZ),SeZ.prev=Red,SeZ.parent=aAd,SeZ.$=JeG,SeZ.$wrapper=ddf,bhf){var aJfaJf=JeG.find(".treemap-node-children");aJfaJf.length||(aJfaJf=aJf('<div class="treemap-node-children"/>').appendTo(JeG)),aJfaJf.css("margin-top",VfI),SeZ.$children=aJfaJf,chg.createNodes(McQ,SeZ)}fKf.listenNodeResize&&ddf.on("resize."+HdE,function(){SeZ.bounds.width=ddf.outerWidth(),SeZ.bounds.height=ddf.outerHeight(),chg.delayDrawLines()}),Red=SeZ,SfL&&SfL(JeG,SeZ)}),aAd||aQd.find('[data-toggle="tooltip"]').tooltip(fKf.tooltip)},aQd.prototype.delayDrawLines=function(){var aJf=this;clearTimeout(aJf.delayDrawLinesTask),aJf.delayDrawLinesTask=setTimeout(function(){aJf.drawLines()},10)},aQd.prototype.drawLines=function(EcJ,aAd){var chg=this,HdE=chg.options,fKf=HdE.rowSpace,VfI={};HdE.cableWidth&&(VfI.borderWidth=HdE.cableWidth),HdE.cableStyle&&(VfI.borderStyle=HdE.cableStyle),HdE.cableColor&&(VfI.borderColor=HdE.cableColor);var aQd=SfL.round(fKf/2),Red=chg.$nodes.offset().left;aJf.each(EcJ||chg.data,function(EcJ,gPe){var SeZ=gPe.$wrapper,bXg=gPe.children,JeG=aJf.extend({height:aQd,top:-aQd-1,left:SfL.round((SeZ.outerWidth()-VfI.borderWidth)/2)},VfI);if(aAd&&!aAd.isOnlyOneChild){var ddf=SeZ.find(".treemap-line-top");ddf.length||(ddf=aJf('<div class="treemap-line-top"/>').appendTo(SeZ)),ddf.css(JeG)}if(bXg&&bXg.length){JeG.top=SeZ.outerHeight()-1,gPe.isOnlyOneChild&&(JeG.height=fKf);var McQ=SeZ.find(".treemap-line-bottom");if(McQ.length||(McQ=aJf('<div class="treemap-line-bottom"/>').appendTo(SeZ),HdE.foldable&&McQ.append('<i class="treemap-node-fold-icon icon" style="transform: translate(-'+SfL.floor(JeG.borderWidth/2)+"px, "+aQd+'px)"/>')),McQ.css(JeG),chg.drawLines(bXg,gPe),bXg.length>1){var bhf=bXg[0],AaC=bXg[bXg.length-1],dJf=gPe.$.children(".treemap-line");dJf.length||(dJf=aJf('<div class="treemap-line"/>').insertAfter(SeZ));var Q=SfL.round(bhf.$wrapper.offset().left-Red+bhf.bounds.width/2);dJf.css(aJf.extend({marginTop:aQd,left:Q,width:AaC.$wrapper.offset().left-Red-Q+AaC.bounds.width/2},VfI))}}}),aAd||chg.callEvent("afterDrawLines")},aQd.prototype.callEvent=function(EcJ,aAd){var SfL=this;if(aJf.isArray(aAd)||(aAd=[aAd]),SfL.$.trigger(EcJ,aAd),aJf.isFunction(SfL.options[EcJ]))return SfL.options[EcJ].apply(SfL,aAd)},aQd.DEFAULTS=fKf,aQd.NAME=HdE,aJf.fn.treemap=function(EcJ,aAd,SfL){return this.each(function(){var chg=aJf(this),fKf=chg.data(HdE),VfI="object"==typeof EcJ&&EcJ;fKf||chg.data(HdE,fKf=new aQd(this,VfI)),"string"==typeof EcJ&&fKf[EcJ](aAd,SfL)})},aJf.fn.treemap.Constructor=aQd}(jQuery,window,document,Math,void 0);
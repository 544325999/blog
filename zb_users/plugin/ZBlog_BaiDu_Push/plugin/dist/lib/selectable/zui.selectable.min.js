/*!
 * ZUI: 拖拽选择 - v1.7.0 - 2017-06-17
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2017 cnezsoft.com; Licensed MIT
 */
!function(eOb){"use strict";var XbN="zui.selectable",aeg=function(aeg,jeG){this.name=XbN,this.$=eOb(aeg),this.id=eOb.zui.uuid(),this.selectOrder=1,this.selections={},this.getOptions(jeG),this._init()},jeG=function(eOb,XbN,aeg){return eOb>=aeg.left&&eOb<=aeg.left+aeg.width&&XbN>=aeg.top&&XbN<=aeg.top+aeg.height},cLf=function(eOb,XbN){var aeg=Math.max(eOb.left,XbN.left),cLf=Math.max(eOb.top,XbN.top),Bbd=Math.min(eOb.left+eOb.width,XbN.left+XbN.width),bXc=Math.min(eOb.top+eOb.height,XbN.top+XbN.height);return jeG(aeg,cLf,eOb)&&jeG(Bbd,bXc,eOb)&&jeG(aeg,cLf,XbN)&&jeG(Bbd,bXc,XbN)};aeg.DEFAULTS={selector:"li,tr,div",trigger:"",selectClass:"active",rangeStyle:{border:"1px solid "+(eOb.zui.colorset?eOb.zui.colorset.primary:"#3280fc"),backgroundColor:eOb.zui.colorset?new eOb.zui.Color(eOb.zui.colorset.primary).fade(20).toCssStr():"rgba(50, 128, 252, 0.2)"},clickBehavior:"toggle",ignoreVal:3},aeg.prototype.getOptions=function(XbN){this.options=eOb.extend({},aeg.DEFAULTS,this.$.data(),XbN)},aeg.prototype.select=function(eOb){this.toggle(eOb,!0)},aeg.prototype.unselect=function(eOb){this.toggle(eOb,!1)},aeg.prototype.toggle=function(XbN,aeg,jeG){var cLf,Bbd,bXc=this.options.selector,Eae=this;if(void 0===XbN)return void this.$.find(bXc).each(function(){Eae.toggle(this,aeg)});if("object"==typeof XbN?(cLf=eOb(XbN).closest(bXc),Bbd=cLf.data("id")):(Bbd=XbN,cLf=Eae.$.find('.slectable-item[data-id="'+Bbd+'"]')),cLf&&cLf.length){if(Bbd||(Bbd=eOb.zui.uuid(),cLf.attr("data-id",Bbd)),void 0!==aeg&&null!==aeg||(aeg=!Eae.selections[Bbd]),!!aeg!=!!Eae.selections[Bbd]){var NaD;eOb.isFunction(jeG)&&(NaD=jeG(aeg)),NaD!==!0&&(Eae.selections[Bbd]=!!aeg&&Eae.selectOrder++,Eae.callEvent(aeg?"select":"unselect",{id:Bbd,selections:Eae.selections,target:cLf,selected:Eae.getSelectedArray()},Eae))}cLf.toggleClass(Eae.options.selectClass,aeg)}},aeg.prototype.getSelectedArray=function(){var XbN=[];return eOb.each(this.selections,function(eOb,aeg){aeg&&XbN.push(eOb)}),XbN},aeg.prototype._init=function(){var XbN,aeg,jeG,Bbd,bXc,Eae,NaD,fWd=this.options,IcX=this,gig=fWd.ignoreVal,BfS=!0,fNc="."+this.name+"."+this.id,GdJ=eOb.isFunction(fWd.checkFunc)?fWd.checkFunc:null,eWg=eOb.isFunction(fWd.rangeFunc)?fWd.rangeFunc:null,ReT=!1,eaf=null,X="mousedown"+fNc,eObeOb=function(){Bbd&&IcX.$children.each(function(){var XbN=eOb(this),aeg=XbN.offset();aeg.width=XbN.outerWidth(),aeg.height=XbN.outerHeight();var jeG=eWg?eWg.call(this,Bbd,aeg):cLf(Bbd,aeg);if(GdJ){var bXc=GdJ.call(IcX,{intersect:jeG,target:XbN,range:Bbd,targetRange:aeg});bXc===!0?IcX.select(XbN):bXc===!1&&IcX.unselect(XbN)}else jeG?IcX.select(XbN):IcX.multiKey||IcX.unselect(XbN)})},XbNeOb=function(cLf){ReT&&(bXc=cLf.pageX,Eae=cLf.pageY,Bbd={width:Math.abs(bXc-XbN),height:Math.abs(Eae-aeg),left:bXc>XbN?XbN:bXc,top:Eae>aeg?aeg:Eae},BfS&&Bbd.width<gig&&Bbd.height<gig||(jeG||(jeG=eOb('.selectable-range[data-id="'+IcX.id+'"]'),jeG.length||(jeG=eOb('<div class="selectable-range" data-id="'+IcX.id+'"></div>').css(eOb.extend({zIndex:1060,position:"absolute",top:XbN,left:aeg,pointerEvents:"none"},IcX.options.rangeStyle)).appendTo(eOb("body")))),jeG.css(Bbd),clearTimeout(NaD),NaD=setTimeout(eObeOb,10),BfS=!1))},aegeOb=function(XbN){eOb(document).off(fNc),clearTimeout(eaf),ReT&&(ReT=!1,jeG&&jeG.remove(),BfS||Bbd&&(clearTimeout(NaD),eObeOb(),Bbd=null),IcX.callEvent("finish",{selections:IcX.selections,selected:IcX.getSelectedArray()}),XbN.preventDefault())},jeGeOb=function(cLf){if(ReT)return aegeOb(cLf);var Bbd=eOb.zui.getMouseButtonCode(fWd.mouseButton);if(!(Bbd>-1&&cLf.button!==Bbd||IcX.altKey||3===cLf.which||IcX.callEvent("start",cLf)===!1)){var bXc=IcX.$children=IcX.$.find(fWd.selector);bXc.addClass("slectable-item");var Eae=IcX.multiKey?"multi":fWd.clickBehavior;if("multi"===Eae?IcX.toggle(cLf.target):"single"===Eae?(IcX.unselect(),IcX.select(cLf.target)):"toggle"===Eae&&IcX.toggle(cLf.target,null,function(eOb){IcX.unselect()}),IcX.callEvent("startDrag",cLf)===!1)return void IcX.callEvent("finish",{selections:IcX.selections,selected:IcX.getSelectedArray()});XbN=cLf.pageX,aeg=cLf.pageY,jeG=null,BfS=!0,ReT=!0,eOb(document).on("mousemove"+fNc,XbNeOb).on("mouseup"+fNc,aegeOb),eaf=setTimeout(function(){eOb(document).on(X,aegeOb)},10),cLf.preventDefault()}},cLfeOb=fWd.container&&"default"!==fWd.container?eOb(fWd.container):this.$;fWd.trigger?cLfeOb.on(X,fWd.trigger,jeGeOb):cLfeOb.on(X,jeGeOb),eOb(document).on("keydown",function(eOb){var XbN=eOb.keyCode;17===XbN||91==XbN?IcX.multiKey=XbN:18===XbN&&(IcX.altKey=!0)}).on("keyup",function(eOb){IcX.multiKey=!1,IcX.altKey=!1})},aeg.prototype.callEvent=function(XbN,aeg){var jeG=eOb.Event(XbN+"."+this.name);this.$.trigger(jeG,aeg);var cLf=jeG.result,Bbd=this.options[XbN];return eOb.isFunction(Bbd)&&(cLf=Bbd.apply(this,eOb.isArray(aeg)?aeg:[aeg])),cLf},eOb.fn.selectable=function(jeG){return this.each(function(){var cLf=eOb(this),Bbd=cLf.data(XbN),bXc="object"==typeof jeG&&jeG;Bbd||cLf.data(XbN,Bbd=new aeg(this,bXc)),"string"==typeof jeG&&Bbd[jeG]()})},eOb.fn.selectable.Constructor=aeg,eOb(function(){eOb('[data-ride="selectable"]').selectable()})}(jQuery);